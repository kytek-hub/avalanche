"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const utxos_1 = require("src/apis/avm/utxos");
const create_hash_1 = __importDefault(require("create-hash"));
const bintools_1 = __importDefault(require("src/utils/bintools"));
const bn_js_1 = __importDefault(require("bn.js"));
const buffer_1 = require("buffer/");
const outputs_1 = require("src/apis/avm/outputs");
const constants_1 = require("src/apis/avm/constants");
const ops_1 = require("src/apis/avm/ops");
const output_1 = require("src/common/output");
const ops_2 = require("src/apis/avm/ops");
/**
 * @ignore
 */
const bintools = bintools_1.default.getInstance();
describe('Operations', () => {
    const codecID_zero = 0;
    const codecID_one = 1;
    const assetID = "8a5d2d32e68bc50036e4d086044617fe4a0a0296b274999ba568ea92da46d533";
    const assetIDBuff = buffer_1.Buffer.from(assetID, "hex");
    const addrs = [
        bintools.cb58Decode("B6D4v1VtPYLbiUvYXtW4Px8oE9imC2vGW"),
        bintools.cb58Decode("P5wdRuZeaDt28eHMP5S3w9ZdoBfo7wuzF"),
        bintools.cb58Decode("6Y3kysjF9jnHnYkdS9yGAuoHyae2eNmeV")
    ].sort();
    const locktime = new bn_js_1.default(54321);
    const payload = buffer_1.Buffer.alloc(1024);
    payload.write("All you Trekkies and TV addicts, Don't mean to diss don't mean to bring static.", 0, 1024, "utf8");
    describe('NFTMintOperation', () => {
        test('SelectOperationClass', () => {
            const goodop = new ops_1.NFTMintOperation(0, buffer_1.Buffer.from(""), []);
            const operation = ops_1.SelectOperationClass(goodop.getOperationID());
            expect(operation).toBeInstanceOf(ops_1.NFTMintOperation);
            expect(() => {
                ops_1.SelectOperationClass(99);
            }).toThrow("Error - SelectOperationClass: unknown opid");
        });
        test('comparator', () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const op1 = new ops_1.NFTMintOperation(1, payload, outputOwners);
            const op2 = new ops_1.NFTMintOperation(2, payload, outputOwners);
            const op3 = new ops_1.NFTMintOperation(0, payload, outputOwners);
            const cmp = ops_1.NFTMintOperation.comparator();
            expect(cmp(op1, op1)).toBe(0);
            expect(cmp(op2, op2)).toBe(0);
            expect(cmp(op3, op3)).toBe(0);
            expect(cmp(op1, op2)).toBe(-1);
            expect(cmp(op1, op3)).toBe(1);
        });
        test('Functionality', () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const op = new ops_1.NFTMintOperation(0, payload, outputOwners);
            expect(op.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID);
            expect(op.getOutputOwners().toString()).toBe(outputOwners.toString());
            const opcopy = new ops_1.NFTMintOperation();
            const opb = op.toBuffer();
            opcopy.fromBuffer(opb);
            expect(opcopy.toString()).toBe(op.toString());
        });
        test("NFTMintOperation codecIDs", () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const nftMintOperation = new ops_1.NFTMintOperation(0, payload, outputOwners);
            expect(nftMintOperation.getCodecID()).toBe(codecID_zero);
            expect(nftMintOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID);
            nftMintOperation.setCodecID(codecID_one);
            expect(nftMintOperation.getCodecID()).toBe(codecID_one);
            expect(nftMintOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID_CODECONE);
            nftMintOperation.setCodecID(codecID_zero);
            expect(nftMintOperation.getCodecID()).toBe(codecID_zero);
            expect(nftMintOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID);
        });
        test("Invalid NFTMintOperation codecID", () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const nftMintOperation = new ops_1.NFTMintOperation(0, payload, outputOwners);
            expect(() => {
                nftMintOperation.setCodecID(2);
            }).toThrow("Error - NFTMintOperation.setCodecID: invalid codecID. Valid codecIDs are 0 and 1.");
        });
    });
    describe('NFTTransferOperation', () => {
        test('SelectOperationClass', () => {
            const nout = new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1);
            const goodop = new ops_1.NFTTransferOperation(nout);
            const operation = ops_1.SelectOperationClass(goodop.getOperationID());
            expect(operation).toBeInstanceOf(ops_1.NFTTransferOperation);
            expect(() => {
                ops_1.SelectOperationClass(99);
            }).toThrow("Error - SelectOperationClass: unknown opid");
        });
        test('comparator', () => {
            const op1 = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1));
            const op2 = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1001, payload, addrs, locktime, 1));
            const op3 = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(999, payload, addrs, locktime, 1));
            const cmp = ops_1.NFTTransferOperation.comparator();
            expect(cmp(op1, op1)).toBe(0);
            expect(cmp(op2, op2)).toBe(0);
            expect(cmp(op3, op3)).toBe(0);
            expect(cmp(op1, op2)).toBe(-1);
            expect(cmp(op1, op3)).toBe(1);
        });
        test('Functionality', () => {
            const nout = new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1);
            const op = new ops_1.NFTTransferOperation(nout);
            expect(op.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID);
            expect(op.getOutput().toString()).toBe(nout.toString());
            const opcopy = new ops_1.NFTTransferOperation();
            opcopy.fromBuffer(op.toBuffer());
            expect(opcopy.toString()).toBe(op.toString());
            op.addSignatureIdx(0, addrs[0]);
            const sigidx = op.getSigIdxs();
            expect(sigidx[0].getSource().toString("hex")).toBe(addrs[0].toString("hex"));
            opcopy.fromBuffer(op.toBuffer());
            expect(opcopy.toString()).toBe(op.toString());
        });
        test("NFTTransferOperation codecIDs", () => {
            const nftTransferOperation = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1));
            expect(nftTransferOperation.getCodecID()).toBe(codecID_zero);
            expect(nftTransferOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID);
            nftTransferOperation.setCodecID(codecID_one);
            expect(nftTransferOperation.getCodecID()).toBe(codecID_one);
            expect(nftTransferOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID_CODECONE);
            nftTransferOperation.setCodecID(codecID_zero);
            expect(nftTransferOperation.getCodecID()).toBe(codecID_zero);
            expect(nftTransferOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID);
        });
        test("Invalid NFTTransferOperation codecID", () => {
            const nftTransferOperation = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1));
            expect(() => {
                nftTransferOperation.setCodecID(2);
            }).toThrow("Error - NFTTransferOperation.setCodecID: invalid codecID. Valid codecIDs are 0 and 1.");
        });
    });
    test('TransferableOperation', () => {
        const nout = new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1);
        const op = new ops_1.NFTTransferOperation(nout);
        const nfttxid = buffer_1.Buffer.from(create_hash_1.default("sha256").update(bintools.fromBNToBuffer(new bn_js_1.default(1000), 32)).digest());
        const nftoutputidx = buffer_1.Buffer.from(bintools.fromBNToBuffer(new bn_js_1.default(1000), 4));
        const nftutxo = new utxos_1.UTXO(constants_1.AVMConstants.LATESTCODEC, nfttxid, nftoutputidx, assetIDBuff, nout);
        const xferop = new ops_1.TransferableOperation(assetIDBuff, [nftutxo.getUTXOID()], op);
        const xferop2 = new ops_1.TransferableOperation(assetIDBuff, [buffer_1.Buffer.concat([nfttxid, nftoutputidx])], op);
        const uid = new ops_2.UTXOID();
        uid.fromString(nftutxo.getUTXOID());
        const xferop3 = new ops_1.TransferableOperation(assetIDBuff, [uid], op);
        expect(xferop.getAssetID().toString("hex")).toBe(assetID);
        const utxoiddeserialized = bintools.cb58Decode(xferop.getUTXOIDs()[0].toString());
        expect(bintools.bufferToB58(utxoiddeserialized)).toBe(nftutxo.getUTXOID());
        expect(xferop.getOperation().toString()).toBe(op.toString());
        const opcopy = new ops_1.TransferableOperation();
        opcopy.fromBuffer(xferop.toBuffer());
        expect(opcopy.toString()).toBe(xferop.toString());
        expect(xferop2.toBuffer().toString("hex")).toBe(xferop.toBuffer().toString('hex'));
        expect(xferop3.toBuffer().toString("hex")).toBe(xferop.toBuffer().toString('hex'));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90ZXN0cy9hcGlzL2F2bS9vcHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDhDQUF5QztBQUN6Qyw4REFBb0M7QUFDcEMsa0VBQXlDO0FBQ3pDLGtEQUFzQjtBQUN0QixvQ0FBZ0M7QUFDaEMsa0RBQXdEO0FBQ3hELHNEQUFxRDtBQUNyRCwwQ0FBaUk7QUFDakksOENBQWdEO0FBRWhELDBDQUF5QztBQUV6Qzs7R0FFRztBQUNILE1BQU0sUUFBUSxHQUFhLGtCQUFRLENBQUMsV0FBVyxFQUFFLENBQUE7QUFFakQsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFTLEVBQUU7SUFDaEMsTUFBTSxZQUFZLEdBQVcsQ0FBQyxDQUFBO0lBQzlCLE1BQU0sV0FBVyxHQUFXLENBQUMsQ0FBQTtJQUM3QixNQUFNLE9BQU8sR0FBVyxrRUFBa0UsQ0FBQTtJQUMxRixNQUFNLFdBQVcsR0FBVyxlQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUN2RCxNQUFNLEtBQUssR0FBYTtRQUNsQixRQUFRLENBQUMsVUFBVSxDQUFDLG1DQUFtQyxDQUFDO1FBQ3hELFFBQVEsQ0FBQyxVQUFVLENBQUMsbUNBQW1DLENBQUM7UUFDeEQsUUFBUSxDQUFDLFVBQVUsQ0FBQyxtQ0FBbUMsQ0FBQztLQUM3RCxDQUFDLElBQUksRUFBRSxDQUFBO0lBRVIsTUFBTSxRQUFRLEdBQU8sSUFBSSxlQUFFLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFbEMsTUFBTSxPQUFPLEdBQVcsZUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUMxQyxPQUFPLENBQUMsS0FBSyxDQUFDLGlGQUFpRixFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFFakgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQVMsRUFBRTtRQUN0QyxJ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LEtBQUssQ0FBQyxDQUFDLENBQUE7UUFDbEYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQ3BGLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVVFhPIH0gZnJvbSAnc3JjL2FwaXMvYXZtL3V0eG9zJ1xuaW1wb3J0IGNyZWF0ZUhhc2ggZnJvbSAnY3JlYXRlLWhhc2gnXG5pbXBvcnQgQmluVG9vbHMgZnJvbSAnc3JjL3V0aWxzL2JpbnRvb2xzJ1xuaW1wb3J0IEJOIGZyb20gJ2JuLmpzJ1xuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSBcImJ1ZmZlci9cIlxuaW1wb3J0IHsgTkZUVHJhbnNmZXJPdXRwdXQgfSBmcm9tICdzcmMvYXBpcy9hdm0vb3V0cHV0cydcbmltcG9ydCB7IEFWTUNvbnN0YW50cyB9IGZyb20gJ3NyYy9hcGlzL2F2bS9jb25zdGFudHMnXG5pbXBvcnQgeyBTZWxlY3RPcGVyYXRpb25DbGFzcywgT3BlcmF0aW9uLCBUcmFuc2ZlcmFibGVPcGVyYXRpb24sIE5GVFRyYW5zZmVyT3BlcmF0aW9uLCBORlRNaW50T3BlcmF0aW9uIH0gZnJvbSAnc3JjL2FwaXMvYXZtL29wcydcbmltcG9ydCB7IE91dHB1dE93bmVycyB9IGZyb20gJ3NyYy9jb21tb24vb3V0cHV0J1xuaW1wb3J0IHsgU2lnSWR4IH0gZnJvbSAnc3JjL2NvbW1vbi9jcmVkZW50aWFscydcbmltcG9ydCB7IFVUWE9JRCB9IGZyb20gJ3NyYy9hcGlzL2F2bS9vcHMnXG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5jb25zdCBiaW50b29sczogQmluVG9vbHMgPSBCaW5Ub29scy5nZXRJbnN0YW5jZSgpXG5cbmRlc2NyaWJlKCdPcGVyYXRpb25zJywgKCk6IHZvaWQgPT4ge1xuICBjb25zdCBjb2RlY0lEX3plcm86IG51bWJlciA9IDBcbiAgY29uc3QgY29kZWNJRF9vbmU6IG51bWJlciA9IDFcbiAgY29uc3QgYXNzZXRJRDogc3RyaW5nID0gXCI4YTVkMmQzMmU2OGJjNTAwMzZlNGQwODYwNDQ2MTdmZTRhMGEwMjk2YjI3NDk5OWJhNTY4ZWE5MmRhNDZkNTMzXCJcbiAgY29uc3QgYXNzZXRJREJ1ZmY6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGFzc2V0SUQsIFwiaGV4XCIpXG4gIGNvbnN0IGFkZHJzOiBCdWZmZXJbXSA9IFtcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShcIkI2RDR2MVZ0UFlMYmlVdllYdFc0UHg4b0U5aW1DMnZHV1wiKSxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShcIlA1d2RSdVplYUR0MjhlSE1QNVMzdzlaZG9CZm83d3V6RlwiKSxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShcIjZZM2t5c2pGOWpuSG5Za2RTOXlHQXVvSHlhZTJlTm1lVlwiKVxuICBdLnNvcnQoKVxuXG4gIGNvbnN0IGxvY2t0aW1lOiBCTiA9IG5ldyBCTig1NDMyMSlcblxuICBjb25zdCBwYXlsb2FkOiBCdWZmZXIgPSBCdWZmZXIuYWxsb2MoMTAyNClcbiAgcGF5bG9hZC53cml0ZShcIkFsbCB5b3UgVHJla2tpZXMgYW5kIFRWIGFkZGljdHMsIERvbid0IG1lYW4gdG8gZGlzcyBkb24ndCBtZWFuIHRvIGJyaW5nIHN0YXRpYy5cIiwgMCwgMTAyNCwgXCJ1dGY4XCIpXG5cbiAgZGVzY3JpYmUoJ05GVE1pbnRPcGVyYXRpb24nLCAoKTogdm9pZCA9PiB7XG4gICAgdGVzdCgnU2VsZWN0T3BlcmF0aW9uQ2xhc3MnLCAoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBnb29kb3A6IE5GVE1pbnRPcGVyYXRpb24gPSBuZXcgTkZUTWludE9wZXJhdGlvbigwLCBCdWZmZXIuZnJvbShcIlwiKSwgW10pXG4gICAgICBjb25zdCBvcGVyYXRpb246IE9wZXJhdGlvbiA9IFNlbGVjdE9wZXJhdGlvbkNsYXNzKGdvb2RvcC5nZXRPcGVyYXRpb25JRCgpKVxuICAgICAgZXhwZWN0KG9wZXJhdGlvbikudG9CZUluc3RhbmNlT2YoTkZUTWludE9wZXJhdGlvbilcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgICAgICAgIFNlbGVjdE9wZXJhdGlvbkNsYXNzKDk5KVxuICAgICAgICAgICAgfSkudG9UaHJvdyhcIkVycm9yIC0gU2VsZWN0T3BlcmF0aW9uQ2xhc3M6IHVua25vd24gb3BpZFwiKVxuICAgIH0pXG5cbiAgICAgIHRlc3QoJ2NvbXBhcmF0b3InLCAoKTogdm9pZCA9PiB7XG4gICAgICAgIGNvbnN0IG91dHB1dE93bmVyczogT3V0cHV0T3duZXJzW10gPSBbXVxuICAgICAgICBvdXRwdXRPd25lcnMucHVzaChuZXcgT3V0cHV0T3duZXJzKGFkZHJzLCBsb2NrdGltZSwgMSkpXG4gICAgICAgIGNvbnN0IG9wMTogTkZUTWludE9wZXJhdGlvbiA9IG5ldyBORlRNaW50T3BlcmF0aW9uKDEsIHBheWxvYWQsIG91dHB1dE93bmVycylcbiAgICAgICAgY29uc3Qgb3AyOiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oMiwgcGF5bG9hZCwgb3V0cHV0T3duZXJzKVxuICAgICAgICBjb25zdCBvcDM6IE5GVE1pbnRPcGVyYXRpb24gPSBuZXcgTkZUTWludE9wZXJhdGlvbigwLCBwYXlsb2FkLCBvdXRwdXRPd25lcnMpXG4gICAgICAgIGNvbnN0IGNtcCA9IE5GVE1pbnRPcGVyYXRpb24uY29tcGFyYXRvcigpXG4gICAgICAgIGV4cGVjdChjbXAob3AxLCBvcDEpKS50b0JlKDApXG4gICAgICAgIGV4cGVjdChjbXAob3AyLCBvcDIpKS50b0JlKDApXG4gICAgICAgIGV4cGVjdChjbXAob3AzLCBvcDMpKS50b0JlKDApXG4gICAgICAgIGV4cGVjdChjbXAob3AxLCBvcDIpKS50b0JlKC0xKVxuICAgICAgICBleHBlY3QoY21wKG9wMSwgb3AzKSkudG9CZSgxKVxuICAgICAgfSlcblxuICAgICAgdGVzdCgnRnVuY3Rpb25hbGl0eScsICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgb3V0cHV0T3duZXJzOiBPdXRwdXRPd25lcnNbXSA9IFtdXG4gICAgICAgIG91dHB1dE93bmVycy5wdXNoKG5ldyBPdXRwdXRPd25lcnMoYWRkcnMsIGxvY2t0aW1lLCAxKSlcbiAgICAgICAgY29uc3Qgb3A6IE5GVE1pbnRPcGVyYXRpb24gPSBuZXcgTkZUTWludE9wZXJhdGlvbigwLCBwYXlsb2FkLCBvdXRwdXRPd25lcnMpXG4gICAgICAgIFxuICAgICAgICBleHBlY3Qob3AuZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShBVk1Db25zdGFudHMuTkZUTUlOVE9QSUQpXG4gICAgICAgIGV4cGVjdChvcC5nZXRPdXRwdXRPd25lcnMoKS50b1N0cmluZygpKS50b0JlKG91dHB1dE93bmVycy50b1N0cmluZygpKVxuICAgICAgICBcbiAgICAgICAgY29uc3Qgb3Bjb3B5OiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oKVxuICAgICAgICBjb25zdCBvcGI6IEJ1ZmZlciA9IG9wLnRvQnVmZmVyKClcbiAgICAgICAgb3Bjb3B5LmZyb21CdWZmZXIob3BiKVxuICAgICAgICBleHBlY3Qob3Bjb3B5LnRvU3RyaW5nKCkpLnRvQmUob3AudG9TdHJpbmcoKSlcbiAgICAgIH0pXG5cbiAgICAgICAgdGVzdChcIk5GVE1pbnRPcGVyYXRpb24gY29kZWNJRHNcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgICAgIGNvbnN0IG91dHB1dE93bmVyczogT3V0cHV0T3duZXJzW10gPSBbXVxuICAgICAgICAgIG91dHB1dE93bmVycy5wdXNoKG5ldyBPdXRwdXRPd25lcnMoYWRkcnMsIGxvY2t0aW1lLCAxKSlcbiAgICAgICAgICBjb25zdCBuZnRNaW50T3BlcmF0aW9uOiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oMCwgcGF5bG9hZCwgb3V0cHV0T3duZXJzKVxuICAgICAgICAgIGV4cGVjdChuZnRNaW50T3BlcmF0aW9uLmdldENvZGVjSUQoKSkudG9CZShjb2RlY0lEX3plcm8pXG4gICAgICAgICAgZXhwZWN0KG5mdE1pbnRPcGVyYXRpb24uZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShBVk1Db25zdGFudHMuTkZUTUlOVE9QSUQpXG4gICAgICAgICAgbmZ0TWludE9wZXJhdGlvbi5zZXRDb2RlY0lEKGNvZGVjSURfb25lKVxuICAgICAgICAgIGV4cGVjdChuZnRNaW50T3BlcmF0aW9uLmdldENvZGVjSUQoKSkudG9CZShjb2RlY0lEX29uZSlcbiAgICAgICAgICBleHBlY3QobmZ0TWludE9wZXJhdGlvbi5nZXRPcGVyYXRpb25JRCgpKS50b0JlKEFWTUNvbnN0YW50cy5ORlRNSU5UT1BJRF9DT0RFQ09ORSlcbiAgICAgICAgICBuZnRNaW50T3BlcmF0aW9uLnNldENvZGVjSUQoY29kZWNJRF96ZXJvKVxuICAgICAgICAgIGV4cGVjdChuZnRNaW50T3BlcmF0aW9uLmdldENvZGVjSUQoKSkudG9CZShjb2RlY0lEX3plcm8pXG4gICAgICAgICAgZXhwZWN0KG5mdE1pbnRPcGVyYXRpb24uZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShBVk1Db25zdGFudHMuTkZUTUlOVE9QSUQpXG4gICAgICAgIH0pXG5cbiAgICAgICAgdGVzdChcIkludmFsaWQgTkZUTWludE9wZXJhdGlvbiBjb2RlY0lEXCIsICgpOiB2b2lkID0+IHtcbiAgICAgICAgICBjb25zdCBvdXRwdXRPd25lcnM6IE91dHB1dE93bmVyc1tdID0gW11cbiAgICAgICAgICBvdXRwdXRPd25lcnMucHVzaChuZXcgT3V0cHV0T3duZXJzKGFkZHJzLCBsb2NrdGltZSwgMSkpXG4gICAgICAgICAgY29uc3QgbmZ0TWludE9wZXJhdGlvbjogTkZUTWludE9wZXJhdGlvbiA9IG5ldyBORlRNaW50T3BlcmF0aW9uKDAsIHBheWxvYWQsIG91dHB1dE93bmVycylcbiAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgbmZ0TWludE9wZXJhdGlvbi5zZXRDb2RlY0lEKDIpXG4gICAgICAgICAgfSkudG9UaHJvdyhcIkVycm9yIC0gTkZUTWludE9wZXJhdGlvbi5zZXRDb2RlY0lEOiBpbnZhbGlkIGNvZGVjSUQuIFZhbGlkIGNvZGVjSURzIGFyZSAwIGFuZCAxLlwiKVxuICAgICAgICB9KVxuICAgIH0pXG5cbiAgZGVzY3JpYmUoJ05GVFRyYW5zZmVyT3BlcmF0aW9uJywgKCk6IHZvaWQgPT4ge1xuICAgIHRlc3QoJ1NlbGVjdE9wZXJhdGlvbkNsYXNzJywgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgbm91dDogTkZUVHJhbnNmZXJPdXRwdXQgPSBuZXcgTkZUVHJhbnNmZXJPdXRwdXQoMTAwMCwgcGF5bG9hZCwgYWRkcnMsIGxvY2t0aW1lLCAxKVxuICAgICAgY29uc3QgZ29vZG9wOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihub3V0KVxuICAgICAgY29uc3Qgb3BlcmF0aW9uOiBPcGVyYXRpb24gPSBTZWxlY3RPcGVyYXRpb25DbGFzcyhnb29kb3AuZ2V0T3BlcmF0aW9uSUQoKSlcbiAgICAgIGV4cGVjdChvcGVyYXRpb24pLnRvQmVJbnN0YW5jZU9mKE5GVFRyYW5zZmVyT3BlcmF0aW9uKVxuICAgICAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XG4gICAgICAgICAgICBTZWxlY3RPcGVyYXRpb25DbGFzcyg5OSlcbiAgICAgICAgICB9KS50b1Rocm93KFwiRXJyb3IgLSBTZWxlY3RPcGVyYXRpb25DbGFzczogdW5rbm93biBvcGlkXCIpXG4gICAgfSlcblxuICAgICAgdGVzdCgnY29tcGFyYXRvcicsICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgb3AxOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihuZXcgTkZUVHJhbnNmZXJPdXRwdXQoMTAwMCwgcGF5bG9hZCwgYWRkcnMsIGxvY2t0aW1lLCAxKSlcbiAgICAgICAgY29uc3Qgb3AyOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihuZXcgTkZUVHJhbnNmZXJPdXRwdXQoMTAwMSwgcGF5bG9hZCwgYWRkcnMsIGxvY2t0aW1lLCAxKSlcbiAgICAgICAgY29uc3Qgb3AzOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihuZXcgTkZUVHJhbnNmZXJPdXRwdXQoOTk5LCBwYXlsb2FkLCBhZGRycywgbG9ja3RpbWUsIDEpKVxuICAgICAgICBjb25zdCBjbXAgPSBORlRUcmFuc2Zlck9wZXJhdGlvbi5jb21wYXJhdG9yKClcbiAgICAgICAgZXhwZWN0KGNtcChvcDEsIG9wMSkpLnRvQmUoMClcbiAgICAgICAgZXhwZWN0KGNtcChvcDIsIG9wMikpLnRvQmUoMClcbiAgICAgICAgZXhwZWN0KGNtcChvcDMsIG9wMykpLnRvQmUoMClcbiAgICAgICAgZXhwZWN0KGNtcChvcDEsIG9wMikpLnRvQmUoLTEpXG4gICAgICAgIGV4cGVjdChjbXAob3AxLCBvcDMpKS50b0JlKDEpXG4gICAgICB9KVxuXG4gICAgICB0ZXN0KCdGdW5jdGlvbmFsaXR5JywgKCk6IHZvaWQgPT4ge1xuICAgICAgICBjb25zdCBub3V0OiBORlRUcmFuc2Zlck91dHB1dCA9IG5ldyBORlRUcmFuc2Zlck91dHB1dCgxMDAwLCBwYXlsb2FkLCBhZGRycywgbG9ja3RpbWUsIDEpXG4gICAgICAgIGNvbnN0IG9wOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihub3V0KVxuICAgICAgICBcbiAgICAgICAgZXhwZWN0KG9wLmdldE9wZXJhdGlvbklEKCkpLnRvQmUoQVZNQ29uc3RhbnRzLk5GVFhGRVJPUElEKVxuICAgICAgICBleHBlY3Qob3AuZ2V0T3V0cHV0KCkudG9TdHJpbmcoKSkudG9CZShub3V0LnRvU3RyaW5nKCkpXG4gICAgICAgIFxuICAgICAgICBjb25zdCBvcGNvcHk6IE5GVFRyYW5zZmVyT3BlcmF0aW9uID0gbmV3IE5GVFRyYW5zZmVyT3BlcmF0aW9uKClcbiAgICAgICAgb3Bjb3B5LmZyb21CdWZmZXIob3AudG9CdWZmZXIoKSlcbiAgICAgICAgZXhwZWN0KG9wY29weS50b1N0cmluZygpKS50b0JlKG9wLnRvU3RyaW5nKCkpXG4gICAgICAgIFxuICAgICAgICBvcC5hZGRTaWduYXR1cmVJZHgoMCwgYWRkcnNbMF0pXG4gICAgICAgIGNvbnN0IHNpZ2lkeDogU2lnSWR4W10gPSBvcC5nZXRTaWdJZHhzKClcbiAgICAgICAgZXhwZWN0KHNpZ2lkeFswXS5nZXRTb3VyY2UoKS50b1N0cmluZyhcImhleFwiKSkudG9CZShhZGRyc1swXS50b1N0cmluZyhcImhleFwiKSlcbiAgICAgICAgb3Bjb3B5LmZyb21CdWZmZXIob3AudG9CdWZmZXIoKSlcbiAgICAgICAgZXhwZWN0KG9wY29weS50b1N0cmluZygpKS50b0JlKG9wLnRvU3RyaW5nKCkpXG4gICAgICB9KVxuXG4gICAgICAgIHRlc3QoXCJORlRUcmFuc2Zlck9wZXJhdGlvbiBjb2RlY0lEc1wiLCAoKTogdm9pZCA9PiB7XG4gICAgICAgICAgY29uc3QgbmZ0VHJhbnNmZXJPcGVyYXRpb246IE5GVFRyYW5zZmVyT3BlcmF0aW9uID0gbmV3IE5GVFRyYW5zZmVyT3BlcmF0aW9uKG5ldyBORlRUcmFuc2Zlck91dHB1dCgxMDAwLCBwYXlsb2FkLCBhZGRycywgbG9ja3RpbWUsIDEpKVxuICAgICAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRDb2RlY0lEKCkpLnRvQmUoY29kZWNJRF96ZXJvKVxuICAgICAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRPcGVyYXRpb25JRCgpKS50b0JlKEFWTUNvbnN0YW50cy5ORlRYRkVST1BJRClcbiAgICAgICAgICBuZnRUcmFuc2Zlck9wZXJhdGlvbi5zZXRDb2RlY0lEKGNvZGVjSURfb25lKVxuICAgICAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRDb2RlY0lEKCkpLnRvQmUoY29kZWNJRF9vbmUpXG4gICAgICAgICAgZXhwZWN0KG5mdFRyYW5zZmVyT3BlcmF0aW9uLmdldE9wZXJhdGlvbklEKCkpLnRvQmUoQVZNQ29uc3RhbnRzLk5GVFhGRVJPUElEX0NPREVDT05FKVxuICAgICAgICAgIG5mdFRyYW5zZmVyT3BlcmF0aW9uLnNldENvZGVjSUQoY29kZWNJRF96ZXJvKVxuICAgICAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRDb2RlY0lEKCkpLnRvQmUoY29kZWNJRF96ZXJvKVxuICAgICAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRPcGVyYXRpb25JRCgpKS50b0JlKEFWTUNvbnN0YW50cy5ORlRYRkVST1BJRClcbiAgICAgICAgfSlcblxuICAgICAgICB0ZXN0KFwiSW52YWxpZCBORlRUcmFuc2Zlck9wZXJhdGlvbiBjb2RlY0lEXCIsICgpOiB2b2lkID0+IHtcbiAgICAgICAgICBjb25zdCBuZnRUcmFuc2Zlck9wZXJhdGlvbjogTkZUVHJhbnNmZXJPcGVyYXRpb24gPSBuZXcgTkZUVHJhbnNmZXJPcGVyYXRpb24obmV3IE5GVFRyYW5zZmVyT3V0cHV0KDEwMDAsIHBheWxvYWQsIGFkZHJzLCBsb2NrdGltZSwgMSkpXG4gICAgICAgICAgZXhwZWN0KCgpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIG5mdFRyYW5zZmVyT3BlcmF0aW9uLnNldENvZGVjSUQoMilcbiAgICAgICAgICB9KS50b1Rocm93KFwiRXJyb3IgLSBORlRUcmFuc2Zlck9wZXJhdGlvbi5zZXRDb2RlY0lEOiBpbnZhbGlkIGNvZGVjSUQuIFZhbGlkIGNvZGVjSURzIGFyZSAwIGFuZCAxLlwiKVxuICAgICAgICB9KVxuICAgIH0pXG5cblxuICB0ZXN0KCdUcmFuc2ZlcmFibGVPcGVyYXRpb24nLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgbm91dDogTkZUVHJhbnNmZXJPdXRwdXQgPSBuZXcgTkZUVHJhbnNmZXJPdXRwdXQoMTAwMCwgcGF5bG9hZCwgYWRkcnMsIGxvY2t0aW1lLCAxKVxuICAgIGNvbnN0IG9wOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihub3V0KVxuICAgIGNvbnN0IG5mdHR4aWQ6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goXCJzaGEyNTZcIikudXBkYXRlKGJpbnRvb2xzLmZyb21CTlRvQnVmZmVyKG5ldyBCTigxMDAwKSwgMzIpKS5kaWdlc3QoKSlcbiAgICBjb25zdCBuZnRvdXRwdXRpZHg6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJpbnRvb2xzLmZyb21CTlRvQnVmZmVyKG5ldyBCTigxMDAwKSwgNCkpXG4gICAgY29uc3QgbmZ0dXR4bzogVVRYTyA9IG5ldyBVVFhPKEFWTUNvbnN0YW50cy5MQVRFU1RDT0RFQywgbmZ0dHhpZCwgbmZ0b3V0cHV0aWR4LCBhc3NldElEQnVmZiwgbm91dClcbiAgICBjb25zdCB4ZmVyb3A6IFRyYW5zZmVyYWJsZU9wZXJhdGlvbiA9IG5ldyBUcmFuc2ZlcmFibGVPcGVyYXRpb24oYXNzZXRJREJ1ZmYsIFtuZnR1dHhvLmdldFVUWE9JRCgpXSwgb3ApXG5cbiAgICBjb25zdCB4ZmVyb3AyOiBUcmFuc2ZlcmFibGVPcGVyYXRpb24gPSBuZXcgVHJhbnNmZXJhYmxlT3BlcmF0aW9uKGFzc2V0SURCdWZmLCBbQnVmZmVyLmNvbmNhdChbbmZ0dHhpZCwgbmZ0b3V0cHV0aWR4XSldLCBvcClcbiAgICBjb25zdCB1aWQ6IFVUWE9JRCA9IG5ldyBVVFhPSUQoKVxuICAgIHVpZC5mcm9tU3RyaW5nKG5mdHV0eG8uZ2V0VVRYT0lEKCkpXG4gICAgY29uc3QgeGZlcm9wMzogVHJhbnNmZXJhYmxlT3BlcmF0aW9uID0gbmV3IFRyYW5zZmVyYWJsZU9wZXJhdGlvbihhc3NldElEQnVmZiwgW3VpZF0sIG9wKVxuXG4gICAgZXhwZWN0KHhmZXJvcC5nZXRBc3NldElEKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoYXNzZXRJRClcbiAgICBjb25zdCB1dHhvaWRkZXNlcmlhbGl6ZWQ6IEJ1ZmZlciA9IGJpbnRvb2xzLmNiNThEZWNvZGUoeGZlcm9wLmdldFVUWE9JRHMoKVswXS50b1N0cmluZygpKVxuICAgIGV4cGVjdChiaW50b29scy5idWZmZXJUb0I1OCh1dHhvaWRkZXNlcmlhbGl6ZWQpKS50b0JlKG5mdHV0eG8uZ2V0VVRYT0lEKCkpXG4gICAgZXhwZWN0KHhmZXJvcC5nZXRPcGVyYXRpb24oKS50b1N0cmluZygpKS50b0JlKG9wLnRvU3RyaW5nKCkpXG5cbiAgICBjb25zdCBvcGNvcHk6IFRyYW5zZmVyYWJsZU9wZXJhdGlvbiA9IG5ldyBUcmFuc2ZlcmFibGVPcGVyYXRpb24oKVxuICAgIG9wY29weS5mcm9tQnVmZmVyKHhmZXJvcC50b0J1ZmZlcigpKVxuICAgIGV4cGVjdChvcGNvcHkudG9TdHJpbmcoKSkudG9CZSh4ZmVyb3AudG9TdHJpbmcoKSlcblxuICAgIGV4cGVjdCh4ZmVyb3AyLnRvQnVmZmVyKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoeGZlcm9wLnRvQnVmZmVyKCkudG9TdHJpbmcoJ2hleCcpKVxuICAgIGV4cGVjdCh4ZmVyb3AzLnRvQnVmZmVyKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoeGZlcm9wLnRvQnVmZmVyKCkudG9TdHJpbmcoJ2hleCcpKVxuICB9KVxufSkiXX0=